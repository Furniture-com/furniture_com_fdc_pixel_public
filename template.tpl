___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.
___INFO___

{
  "displayName": "Furniture.com pixel",
  "categories": [
    "TAG_MANAGEMENT",
    "UTILITY",
    "ANALYTICS"
  ],
  "description": "The FdC Tag Template is an easy way to share data with us and helps us provide more value to you.",
  "__wm": "VGVtcGxhdGUtQXV0aG9yX0dvb2dsZS1UYWctTWFuYWdlci1Nb25pdG9yLVNpbW8tQWhhdmE\u003d",
  "securityGroups": [],
  "id": "cvt_PJ4XQ",
  "type": "TAG",
  "version": 1,
  "brand": {
    "displayName": "Furniture-com",
    "id": "github.com_Furniture-com",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "identificationCode",
    "displayName": "Identification Code",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Please enter your unique TagID provided by Furniture.com",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "endpointName",
    "displayName": "Name Endpoint",
    "simpleValueType": true,
    "help": "FDC must provide this value for you",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "eventName",
    "displayName": "Event Name",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "view_item",
        "displayValue": "PDP View"
      },
      {
        "value": "purchase",
        "displayValue": "Transaction"
      },
      {
        "value": "favorite",
        "displayValue": "Favorite"
      },
      {
        "value": "add_to_cart",
        "displayValue": "Add To Cart"
      },
      {
        "value": "create_account",
        "displayValue": "Create Account"
      },
      {
        "value": "begin_checkout",
        "displayValue": "Begin Checkout"
      },
      {
        "value": "select_filter",
        "displayValue": "Filter"
      },
      {
        "value": "search",
        "displayValue": "Search"
      },
      {
        "value": "page_view",
        "displayValue": "Page View"
      },
      {
        "value": "financial_application",
        "displayValue": "Financial Application"
      },
      {
        "value": "other",
        "displayValue": "Other"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "page_view",
    "help": "Choose an event name to send to the Furniture.com endpoint",
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includePageType",
    "checkboxText": "Check to include page_type with the event",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "page_view",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "page_type",
    "displayName": "Page Type",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "includePageType",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false,
    "help": "Add your page_type variable here.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includeTx",
    "checkboxText": "Check to include transaction id with network request",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "purchase",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "transactionId",
    "displayName": "Transaction ID",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "includeTx",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false,
    "help": "Add your transaction id variable here.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includeItemID",
    "checkboxText": "Check to include Item ID with network request",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "view_item",
        "type": "EQUALS"
      },
      {
        "paramName": "eventName",
        "paramValue": "favorite",
        "type": "EQUALS"
      },
      {
        "paramName": "eventName",
        "paramValue": "add_to_cart",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "itemID",
    "displayName": "Item ID",
    "simpleValueType": true,
    "help": "Add your Item ID variable here",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "includeItemID",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includeRevenue",
    "checkboxText": "Check to include Revenue with purchase event",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "purchase",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "revenue",
    "displayName": "Revenue",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "includeRevenue",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "help": "Add your Revenue variable here",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includeFilter",
    "checkboxText": "Check to include Filter Type variable here",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "select_filter",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "filter",
    "displayName": "Filter",
    "simpleValueType": true,
    "help": "Add your Filter Type variable here",
    "enablingConditions": [
      {
        "paramName": "includeFilter",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includeSearch",
    "checkboxText": "Check to include Search Query variable here",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "search",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "search",
    "displayName": "Search",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "includeSearch",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "help": "Add your Search variable here",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "includeItemsInPurchase",
    "checkboxText": "Check to  Include Items in Cart",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "purchase",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "itemsArray",
    "displayName": "itemsArray",
    "simpleValueType": true,
    "help": "Add the items variable here. This variable should be an array",
    "enablingConditions": [
      {
        "paramName": "includeItemsInPurchase",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "include UniqueID",
    "checkboxText": "Check to include the unique variable variable here",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "financial_application",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "applicationId",
    "displayName": "Add your id variable here.",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "include UniqueID",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "include event_name",
    "checkboxText": "Check to include a custom event name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "eventName",
        "paramValue": "other",
        "type": "EQUALS"
      }
    ],
    "alwaysInSummary": false
  },
  {
    "type": "TEXT",
    "name": "customEventName",
    "displayName": "Custom Event Name",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "include event_name",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// FDC Pixel V2
// Set API requirements
const sendPixel = require('sendPixel');
const getTimestamp = require('getTimestamp');
const makeInteger = require('makeInteger');
const makeString = require('makeString');
const setCookie = require('setCookie');
const getCookie = require('getCookieValues');
const log = require('logToConsole');
const queryPermission = require('queryPermission');
const getUrl = require('getUrl');
const object = require('Object');
const parseUrl = require('parseUrl');
const encodeUriComponent = require('encodeUriComponent');

let utmId;

// -------------------------
// Set variables
// -------------------------
const cookieValues = getCookie('__fdc_values')[0];
const gaCookie = getCookie('_ga')[0] ? getCookie('_ga')[0].split('.').slice(-2).join('.') : ''; // Google Analytics client ID
const event = data.eventName;
const eventTimestamp = getTimestamp();
const url = getUrl();
const val = parseUrl(url);
const obj = val.searchParams;

// Get UTM params from URL
const utmSource   = obj.utm_source   || '';
const utmMedium   = obj.utm_medium   || '';
const utmCampaign = obj.utm_campaign || '';
const page_type = data.page_type;

// Partner-specific info
const partnerCode = data.identificationCode;
const endPoint = data.endpointName;
const itemID = data.itemID;
const sendUrl = val.hostname + val.pathname;

// -------------------------
// Cookies Logic
// -------------------------
if (obj.utm_id && obj.utm_source === 'fdc') {
    utmId = obj.utm_id;
    if (queryPermission('set_cookies', '__fdc_values')) {
        setCookie("__fdc_values", utmId, {
            domain: 'auto',
            path: '/',
            'max-age': 3600000 * 24 * 365, // 1 year
        });
    } else {
        log('Invalid permissions for writing cookie!');
    }
} else if (cookieValues.length > 0) {
    utmId = cookieValues;
}
// -------------------------

// -------------------------
// Send payload if utmId is available
// -------------------------
if (utmId) {
    let payload;

    // View Item Event
    if (event == 'view_item') {
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&itemId=' + itemID + 
            '&url=' + sendUrl;
    }

    // Page View Event
    else if (event == 'page_view') {
                payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp +
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie +
            '&page_type=' + page_type + 
            '&url=' + sendUrl;

        if (utmSource || utmMedium || utmCampaign) {
            if (utmSource)   payload += '&utm_source='   + encodeUriComponent(utmSource);
            if (utmMedium)   payload += '&utm_medium='   + encodeUriComponent(utmMedium);
            if (utmCampaign) payload += '&utm_campaign=' + encodeUriComponent(utmCampaign);
        }

    }

    // Purchase Event
    else if (event == 'purchase') {
        const transactionId = data.transactionId;
        const revenue = data.revenue;
        const items_array = data.itemsArray;
        const includeItems = data.includeItemsInPurchase;
        let item_id_string;
        let basketSize;
        if (includeItems && items_array && items_array.length > 0) {
            item_id_string = items_array.join('_');
            basketSize = items_array.length;
        }
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&itemId=' + item_id_string + 
            '&transactionId=' + transactionId + '&basketSize=' + basketSize + '&revenue=' + revenue + 
            '&url=' + sendUrl;
    }

    // Add to Cart Event
    else if (event == 'add_to_cart') {
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&itemId=' + itemID + 
            '&url=' + sendUrl;
    }

    // Favorite Event
    else if (event == 'favorite') {
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&itemId=' + itemID + 
            '&url=' + sendUrl;
    }

    // Create Account Event
    else if (event == 'create_account') {
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + 
            '&url=' + sendUrl;
    }

    // Begin Checkout Event
    else if (event == 'begin_checkout') {
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + 
            '&url=' + sendUrl;
    }

    // Custom Other Event
    else if (event == 'other') {
        const customEventName = data.customEventName;
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event +  '&customEventName=' + customEventName + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + 
            '&url=' + sendUrl;
    }

    // Select Filter Event
    else if (event == 'select_filter') {
        const filter = data.filter;
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&filter=' + filter + 
            '&url=' + sendUrl;
    }

    // Search Event
    else if (event == 'search') {
        let search_string;
        const includeSearch = data.includeSearch;
        if (includeSearch) {
            const submited_search = data.search;
            const search_array = submited_search.split(" ");
            search_string = search_array.join('_');
        }
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&search=' + search_string + 
            '&url=' + sendUrl;
    }

    // Financial Application Event
    else if (event == 'financial_application') {
        const applicationId = data.applicationId;
        payload = '?partnerCode=' + partnerCode + '&eventName=' + event + '&eventTimestamp=' + eventTimestamp + 
            '&user_session_id=' + utmId + '&partnerUserPseudoId=' + gaCookie + '&applicationId=' + applicationId + 
            '&url=' + sendUrl;
    }

    // Send the pixel
    sendPixel(endPoint + payload, null, null);
    data.gtmOnSuccess(); // Signal tag completion
}

return;


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://us-east4-fdc-partners-pixel.cloudfunctions.net/fdc-pixel*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "__fdc_values"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "__fdc_values"
              },
              {
                "type": 1,
                "string": "_ga"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 11/07/2019, 09:11:59


